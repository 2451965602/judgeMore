# 评多多后端README

> 一个面向高校竞赛/活动材料审核场景的智能后端服务系统

## 项目简介

`评多多` 是一个基于 **CloudWeGo Hertz** 构建的高性能 Go 后端服务，专为高校或组织中的**竞赛/活动材料提交与审核流程**设计。系统提供完整的用户生命周期管理（注册、邮箱验证、登录、信息维护），支持学生上传赛事证明材料（如获奖证书、参赛证明），并集成 **AI 智能解析**（基于 GLM-4V 大模型）自动提取赛事关键信息，大幅提升审核效率。

项目采用现代化分层架构，支持 **MySQL + Redis + 七牛云 OSS** 存储，具备配置热重载、JWT 鉴权、结构化日志、错误码统一管理等企业级特性。

## 核心亮点

✅ AI 智能解析：上传证书图片，自动识别赛事关键字段（赛事名、主办方、时间、奖项等级等）
✅ 安全邮箱注册：仅限 @fzu.edu.cn 邮箱注册（可配置），6位高强度验证码，Redis 存储，10分钟有效期，一次性使用
✅ 云原生存储架构：本地临时缓存 + 七牛云 OSS 永久存储，支持断点续传与安全类型校验
✅ 动态配置热重载：基于 Viper 的 YAML 配置管理，无需重启服务即可生效
✅ 标准化响应体系：统一错误码 + 规范化 JSON 响应格式，便于前端对接
✅ 高可用设计：MySQL 连接池优化、端口自动探测、服务健康检查
✅ RBAC 权限模型：支持学院/专业/年级维度的管理员权限绑定
✅ 强密码与权限安全：用户密码使用 bcrypt 哈希存储，防彩虹表攻击；管理员权限支持按 学院 或 专业+年级 维度精细化绑定
✅ 申诉闭环机制：提供完整的申诉流程——发起 → 查询 → 处理 → 反馈，支持附件上传与状态追踪
✅ 智能全文检索：基于 Elasticsearch 构建赛事知识库，支持对“赛事名称”“主办方”等字段进行分词模糊搜索，管理员可快速定位已认可赛事模板，提升规则配置效率

## 技术架构

### 1. 核心依赖

| 组件                | 用途                                    |
| ------------------- |---------------------------------------|
| **CloudWeGo Hertz** | 高性能 HTTP 框架                           |
| **GORM**            | MySQL ORM，支持连接池、事务                    |
| **Redis**           | 验证码缓存、Token 黑名单                  |
| **七牛云 Go SDK**   | 文件上传至对象存储                             |
| **GLM-4V API**      | 多模态大模型，解析证书图片                         |
| **Viper**           | 配置管理，支持 YAML + 热重载                    |
| **filetype**        | 安全的文件类型检测                             |
| **bcrypt**        | 安全哈希用户密码                              |
| **JWT**        | 用户登录态管理                               |
| **SMTP**        | 用于发送邮箱验证码与通知，支持 TLS 加密                |
| **Elasticsearch v7**        | 实现赛事模板的全文检索与模糊匹配                      |
| **olivere/elastic/v7**        | Go 客户端库，用于与 Elasticsearch 交互          |
| **Sonic**        | 高性能 JSON 编解码库（bytedance），用于 ES 返回结果解析 |


### 2. 目录结构

```t
biz/
├── dal/               # 数据访问（MySQL/Redis）
├── service/           # 业务逻辑（含 AI 调用、OSS 上传）
├── handler/           # HTTP 处理函数（Hertz 生成）
├── pack/              # 响应数据转换
├── router/            # 路由注册
├── mw/                # JWT 中间件
├── model/             # 请求/响应模型
config/                # 配置管理
pkg/
├── utils/             # 工具：SMTP、OSS、AI 调用、DSN 解析
├── errno/             # 统一错误码
├── constants/         # 常量（如表名）
main.go                # 服务入口
```

